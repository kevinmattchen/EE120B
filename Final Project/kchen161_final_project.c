/*	Author: kchen161
 *      Partner(s) Name: Kevin Chen
 *	Lab Section: 23
 *	Assignment: Final Project, music player microcontroller
 *	Exercise Description: [optional - include for your own benefit]
 *
 *	I acknowledge all content contained herein, excluding template or example
 *	code, is my own original work.
 */
#include <avr/io.h>
#include <stdio.h>
#ifdef _SIMULATE_
#include "simAVRHeader.h"
#endif
#include <avr/interrupt.h>
#include <avr/eeprom.h>
#include <math.h>
#include <string.h>
#include "io.c"

#define FOSC 8000000
#define BAUD 9600
#define MYUBRR FOSC/16/BAUD-1

#if 1 //IR remote codes
	#define Power       'W'
	#define FuncStop    'F'
	#define VolUp       '+'
	#define VolDown     '-'
	#define Previous    'R'
	#define Next        'N'
	#define PlayPause   'P'
	#define Down        'D'
	#define Up          'U'
	#define Eq          'E'
	#define StRept      'S'
	#define Remote0     '0'
	#define Remote1     '1'
	#define Remote2     '2'
	#define Remote3     '3'
	#define Remote4     '4'
	#define Remote5     '5'
	#define Remote6     '6'
	#define Remote7     '7'
	#define Remote8     '8'
	#define Remote9     '9'
	#define hold        'H'
#endif

#if 1 //music

	#if 1 //note definitions
	#define C 130.8*2
	#define Db 138.6*2
	#define D 146.8*2
	#define Eb 155.6*2
	#define E 164.8*2
	#define F 174.6*2
	#define Gb 185*2
	#define G 196*2
	#define Ab 207.7*2
	#define A 220*2
	#define Bb 233.1*2
	#define B 246.9*2
	#define Cb B
	#define Fb E
	#define Cs Db
	#define Ds Eb
	#define Fs Gb
	#define Gs Ab
	#define As Bb
	#endif

	#if 1 //Megalovania
		#if 1 //Megalovania Melody note arrays
		short MegMm1[]  = {D, D, D*2, A, Gs, G, F, D, F, G,                         C, C, D*2, A, Gs, G, F, D, F, G,                             B/2, B/2, D*2, A, Gs, G, F, D, F, G,                      Bb/2, Bb/2, D*2, A, Gs, G, F, D, F, G, -1};
		short MegMm1_L[] = {100, 100, 100, 100, 100, 100, 200, 100, 100, 100,       100, 100, 100, 100, 100, 100, 200, 100, 100, 100,            100, 100, 100, 100, 100, 100, 200, 100, 100, 100,         100, 100, 100, 100, 100, 100, 200, 100, 100, 100};
		short MegMm1_R[] = {25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,   25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,        25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,     25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25};

		short MegMm5[]  = {D, D, D*2, A, Gs, G, F, D, F, G,                         C, C, D*2, A, Gs, G, F, D, F, G,                             B/2, B/2, D*2, A, Gs, G, F, D, F, G,                      Bb/2, Bb/2, D*2, A, Gs, G, F, D, F, G, -1};
		short MegMm5_L[] = {100, 100, 100, 100, 100, 100, 200, 100, 100, 100,       100, 100, 100, 100, 100, 100, 200, 100, 100, 100,            100, 100, 100, 100, 100, 100, 200, 100, 100, 100,         100, 100, 100, 100, 100, 100, 200, 100, 100, 100};
		short MegMm5_R[] = {25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,   25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,        25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,     25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25};

		short MegMm9[]  = {D*2, D*2, D*4, A*2, Gs*2, G*2, F*2, D*2, F*2, G*2,       C*2, C*2, D*4, A*2, Gs*2, G*2, F*2, D*2, F*2, G*2,           B, B, D*4, A*2, Gs*2, G*2, F*2, D*2, F*2, G*2,            Bb, Bb, D*4, A*2, Gs*2, G*2, F*2, D*2, F*2, G*2, -1};
		short MegMm9_L[] = {100, 100, 100, 100, 100, 100, 200, 100, 100, 100,       100, 100, 100, 100, 100, 100, 200, 100, 100, 100,            100, 100, 100, 100, 100, 100, 200, 100, 100, 100,         100, 100, 100, 100, 100, 100, 200, 100, 100, 100};
		short MegMm9_R[] = {25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,   25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,        25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,     25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25};

		short MegMm13[]  = {D*2, D*2, D*4, A*2, Gs*2, G*2, F*2, D*2, F*2, G*2,       C*2, C*2, D*4, A*2, Gs*2, G*2, F*2, D*2, F*2, G*2,           B, B, D*4, A*2, Gs*2, G*2, F*2, D*2, F*2, G*2,            Bb, Bb, D*4, A*2, Gs*2, G*2, F*2, D*2, C*2, D*2, E*2, -1};
		short MegMm13_L[] = {100, 100, 100, 100, 100, 100, 200, 100, 100, 100,       100, 100, 100, 100, 100, 100, 200, 100, 100, 100,            100, 100, 100, 100, 100, 100, 200, 100, 100, 100,         100, 100, 100, 100, 100, 100, 200, 100, 100, 40, 35};
		short MegMm13_R[] = {25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,   25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,        25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,     25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 12, 13};

		short MegMm17[]   = {E*2, F*2, F*2, F*2, F*2, E*2, F*2, D*2, D*2,        F*2, F*2, F*2, G*2, Ab*2, G*2, Ab*2, G*2, D*2, F*2, G*2,   F*2, F*2, F*2, G*2, Ab*2, A*2, C*4, A*2,              D*4, D*4, D*4, A*2, D*4, C*4, -1};
		short MegMm17_L[] = {22, 200, 100, 100, 100, 22, 200, 100, 125+500-50,   200, 100, 100, 100, 200, 50, 50, 50, 100, 100, 100,        200, 100, 50, 100, 100, 100, 100, 125+250-50,         200, 200, 100, 100, 100, 125+500*2-50};
		short MegMm17_R[] = {3, 50, 25, 25+125, 25+125-25, 3, 50, 25+125, 50,    50, 25, 25+125, 25+125, 50, 12, 13, 75, 25, 25, 25+250,    50, 25, 75+125, 25+125, 25+125, 25+125, 25+125, 50,   50, 50, 25, 25, 25, 50};

		short MegMm21[]   = {A*2, A*2, A*2, A*2, Gs*2, A*2, G*2, G*2,        A*2, A*2, A*2, A*2, G*2, A*2, D*4, A*2, G*2,     D*4, A*2, G*2, F*2, C*4, G*2, F*2, E*2,    B, D*2, E*2, F*2, C*4, -1};
		short MegMm21_L[] = {200, 100, 100, 100, 22, 200, 100, 125+500-50,   200, 200, 100, 50, 50, 50, 200, 100, 200,        200, 200, 200, 200, 200, 200, 200, 200,    200, 100, 100, 100, 125+2*500-50};
		short MegMm21_R[] = {50, 25, 25+125, 25+125-25, 3, 50, 25+125, 50,   50, 50, 25, 75+125, 75+125, 75+125, 50, 25, 50,  50, 50, 50, 50, 50, 50, 50, 50,            50, 25, 150, 150, 50};

		short MegMm25[]   = {0, F*2, D*2, F*2, G*2, Ab*2, G*2, F*2, D*2,    Ab*2, G*2, D*2, F*2, G*2, Gs*2, A*2,        C*4, A*2, Gs*2, G*2, F*2, D*2, E*2, F*2, G*2, A*2, C*4,    Db*4, Ab*2, Ab*2, G*2, F*2, G*2,         D*2, E*2, F*2, F*4, E*4, D*4,    E*4, F*4, G*4, E*4,   A*4, A*4, Gs*4, G*4, Fs*4, F*4, E*4, Ds*4, D*4,      Cs*4, Eb*4, -1};
		short MegMm25_L[] = {0, 100, 100, 100, 100, 100, 100, 100, 100,     50, 50, 100, 200, 2*500+125-50, 200, 100,   100, 100, 100, 100, 100, 100, 100, 200, 200, 200, 200,     200, 100, 100, 100, 100, 125+2*500-50,   200, 200, 200, 200, 450, 450,    450, 450, 450, 450,   2*500-50, 100, 100, 100, 100, 100, 100, 100, 100,    2*500, 2*500-50};
		short MegMm25_R[] = {2*500+100, 25, 25, 25, 25, 25, 25, 25, 25,     12, 13, 25, 50, 50, 50, 25,                 25+125, 25, 25, 25, 25, 25, 25, 50, 50, 50, 50,            50, 25+125, 25, 25, 25, 50,              50, 50, 50, 50, 50, 50,          50, 50, 50, 50,       50, 25, 25, 25, 25, 25, 25, 25, 25,                  0, 50};

		short MegMm33[]   = {Bb/2, F,      E, D,               F,            0,           Bb/2, F,      E, D,               D, D/2, -1};
		short MegMm33_L[] = {3*500, 450,   2*500, 2*500-50,    4*500-50,     0,           3*500, 450,   2*500, 2*500-50,    7*500, 450};
		short MegMm33_R[] = {0, 50,        0, 50,              50,           4*500+125,   0, 50,        0, 50,              0, 50};

		short MegMm41[]   = {Bb/2, F,       E, D,              F,          G*2, D*4, F*4, D*4, G*4, F*4, D*4, C*4, A*2, G*2, A*2, C*4,     Bb/2, F,       E, D,               D, F*2, E*2, C*2, E*2, D*2, G, A, C*2,                  F*2, E*2, C*2, E*2, D*2, G, A, C*2, -1};
		short MegMm41_L[] = {3*500, 450,    2*500, 2*500-50,   4*500-50,   100, 100, 100, 100, 100, 100, 100, 100, 200, 100, 100, 100,     3*500, 450,    2*500, 2*500-50,    200, 100, 100, 100, 100, 200, 100, 100, 100,            100, 100, 100, 100, 200, 100, 100, 100};
		short MegMm41_R[] = {0, 50,         0, 50,             50,         25, 25, 25, 25, 150, 150, 25, 25+125, 50, 25, 25, 25,           0, 50,         0, 50,              50, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25+250,   150, 150+125, 25+125, 25+125, 50, 25, 25, 25};

		short MegMm49[]   = {0, -1};
		short MegMm49_L[] = {0};
		short MegMm49_R[] = {4*500*14+250+250};

		short MegMm63[]   = {D, D, D*2, A, Gs, G, F, D, F, G,                         D, D, D*2, A, Gs, G, F, D, F, G,                            Bb/2, Bb/2, D*2, A, Gs, G, F, D, F, G,                    C, C, D*2, A, Gs, G, F, D, F, G,                           D, D, D*2, A, Gs, G, F, D, F, G,                         D, D, D*2, A, Gs, G, F, D, F, G,                            Bb/2, Bb/2, D*2, A, Gs, G, F, D, F, G,                    C, C, D*2, A, Gs, G, F, D, F, G, -1};
		short MegMm63_L[] = {100, 100, 100, 100, 100, 100, 200, 100, 100, 100,       100, 100, 100, 100, 100, 100, 200, 100, 100, 100,            100, 100, 100, 100, 100, 100, 200, 100, 100, 100,         100, 100, 100, 100, 100, 100, 200, 100, 100, 100,          100, 100, 100, 100, 100, 100, 200, 100, 100, 100,       100, 100, 100, 100, 100, 100, 200, 100, 100, 100,            100, 100, 100, 100, 100, 100, 200, 100, 100, 100,         100, 100, 100, 100, 100, 100, 200, 100, 100, 100};
		short MegMm63_R[] = {25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,   25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,        25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,     25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,      25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,   25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,        25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,     25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25+1000};
		#endif

		#if 1 //Megalovania Harmony note arrays
		short MegHm1[]   = {0, -1};
		short MegHm1_L[] = {0};
		short MegHm1_R[] = {4*500*4+250};

		short MegHm5[]   = {D,                    C,                B/2,             Bb/2,          C, -1};
		short MegHm5_L[] = {125+250+500*2+100,    250+500*3-50,     250+500*3-50,    250+250+100,   125+500*2-50};
		short MegHm5_R[] = {25+3*125+250,         50+250,           50+250,          25,            50+100};

		short MegHm9[]   = {D, D, D*2, A, Gs, G, F, D, F, G,                         C, C, D*2, A, Gs, G, F, D, F, G,                             B/2, B/2, D*2, A, Gs, G, F, D, F, G,                      Bb/2, Bb/2, D*2, A, Gs, G, F, D, F, G, -1};
		short MegHm9_L[] = {100, 100, 100, 100, 100, 100, 200, 100, 100, 100,       100, 100, 100, 100, 100, 100, 200, 100, 100, 100,            100, 100, 100, 100, 100, 100, 200, 100, 100, 100,         100, 100, 100, 100, 100, 100, 200, 100, 100, 100};
		short MegHm9_R[] = {25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,   25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,        25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,     25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25};

		short MegHm13[]   = {D, D, D*2, A, Gs, G, F, D, F, G,                         C, C, D*2, A, Gs, G, F, D, F, G,                             B/2, B/2, D*2, A, Gs, G, F, D, F, G,                      Bb/2, Bb/2, D*2, A, Gs, G, F, D, -1};
		short MegHm13_L[] = {100, 100, 100, 100, 100, 100, 200, 100, 100, 100,       100, 100, 100, 100, 100, 100, 200, 100, 100, 100,            100, 100, 100, 100, 100, 100, 200, 100, 100, 100,         100, 100, 100, 100, 100, 100, 200, 100};
		short MegHm13_R[] = {25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,   25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,        25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,     25, 25, 150, 150+125, 25+125, 25+125, 50, 25+250};

		short MegHm17[]   = {0, G*4, -1};
		short MegHm17_L[] = {0, 125+500-50};
		short MegHm17_R[] = {4*500*4-125-500, 50+125};

		short MegHm21[]   = {F*2, F*2, F*2, F*2, E*2, F*2, D*2, D*2,         F*2, F*2, F*2, F*2, D*2, F*2, E*2, D*2, C*2,     F*2, A*2, G*2, F*2, E*2, G*2, F*2, E*2,    G, Bb, C*2, D*2, E*2, -1};
		short MegHm21_L[] = {200, 100, 100, 100, 22, 200, 100, 125+500-50,   200, 200, 100, 50, 50, 50, 200, 100, 200,        200, 200, 200, 200, 200, 200, 200, 200,    200, 100, 100, 100, 125+2*500-50};
		short MegHm21_R[] = {50, 25, 25+125, 25+125-25, 3, 50, 25+125, 50,   50, 50, 25, 75+125, 75+125, 75+125, 50, 25, 50,  50, 50, 50, 50, 50, 50, 50, 50,            50, 25, 150, 150, 50};

		short MegHm25[]   = {0, D*2, B, D*2, D*2, D*2, D*2, D*2, B,         F*2, E*2, D*2, D*2, E*2, Gs*2, A*2,         C*4, A*2, Gs*2, G*2, F*2, D*2, E*2, F*2, G*2, A*2, C*4,    Db*4, Ab*2, Ab*2, G*2, F*2, G*2,         F, G, A, A*2, G*2, F*2,          G*2, A*2, C*4, A*2,   D*4, A*4, Gs*4, G*4, Fs*4, F*4, E*4, Ds*4, D*4,      Gs*2, B*2, -1};
		short MegHm25_L[] = {0, 100, 100, 100, 100, 100, 100, 100, 100,     50, 50, 100, 200, 2*500+125-50, 200, 100,   100, 100, 100, 100, 100, 100, 100, 200, 200, 200, 200,     200, 100, 100, 100, 100, 125+2*500-50,   200, 200, 200, 200, 450, 450,    450, 450, 450, 450,   2*500-50, 100, 100, 100, 100, 100, 100, 100, 100,    2*500, 2*500-50};
		short MegHm25_R[] = {2*500+100, 25, 25, 25, 25, 25, 25, 25, 25,     12, 13, 25, 50, 50, 50, 25,                 25+125, 25, 25, 25, 25, 25, 25, 50, 50, 50, 50,            50, 25+125, 25, 25, 25, 50,              50, 50, 50, 50, 50, 50,          50, 50, 50, 50,       50, 25, 25, 25, 25, 25, 25, 25, 25,                  0, 50};

		short MegHm33[]   = {Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4,   C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2,       B/4, B/4, B/4, B/4, B/4, B/4, B/4, B/4, B/4, B/4,	     B/4, B/4, B/4, B/4, B/4, B/4, B/4, B/4, B/4, B/4,	               Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4,   C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2,       D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2,	      D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, -1};
		short MegHm33_L[] = {100, 100, 100, 100, 100, 100, 100, 100, 100, 200,             100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,        100, 100, 100, 100, 100, 100, 100, 100, 100, 200,                 100, 100, 100, 100, 100, 100, 100, 100, 100, 200,             100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,        100, 100, 100, 100, 100, 100, 100, 100, 100, 200};
		short MegHm33_R[] = {150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,         150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,    150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,             150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,         150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,    150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50};

		short MegHm41[]   = {D/2, D, A/2, Ab/2, G/2, F/2, D/2, F/2, G/2,        C/2, C/2, D, A/2, Ab/2, G/2, F/2, D/2, F/2, G/2,             B/4, B/4, D, A/2, Ab/2, G/2, F/2, D/2, F/2, G/2,          B/4, B/4, D, A/2, Ab/2, G/2, F/2, D/2, F/2, G/2,               D/2, D, A/2, Ab/2, G/2, F/2, D/2, F/2, G/2,        C/2, C/2, D, A/2, Ab/2, G/2, F/2, D/2, F/2, G/2,        D, F, E, C, E, D, G, A, C*2,                            F, E, C, E, D, G, A, C*2, -1};
		short MegHm41_L[] = {100, 100, 100, 100, 100, 200, 100, 100, 100,       100, 100, 100, 100, 100, 100, 200, 100, 100, 100,            100, 100, 100, 100, 100, 100, 200, 100, 100, 100,         100, 100, 100, 100, 100, 100, 200, 100, 100, 100,              100, 100, 100, 100, 100, 200, 100, 100, 100,       100, 100, 100, 100, 100, 100, 200, 100, 100, 50,       200, 100, 100, 100, 100, 200, 100, 100, 100,            100, 100, 100, 100, 200, 100, 100, 100};
		short MegHm41_R[] = {25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,  25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,        25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,     25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25+125,      25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,  25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 0,   50, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25+250,   150, 150+125, 25+125, 25+125, 50, 25, 25, 25+50};

		short MegHm49[]   = {Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4,   C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2,       D/2, D/2, D/2, D/2, Cs/2, Cs/2, Cs/2, Cs/2, Cs/2, Cs/2,	     C/2, C/2, C/2, C/2, B/4, B/4, B/4, B/4, B/4, B/4,      Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4,   C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2,       D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2,	     D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2,      Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4,   C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2,       D/2, D/2, D/2, D/2, Cs/2, Cs/2, Cs/2, Cs/2, Cs/2, Cs/2,	     C/2, C/2, C/2, C/2, B/4, B/4, B/4, B/4, B/4, B/4,       Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4, Bb/4,   C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, -1};
		short MegHm49_L[] = {100, 100, 100, 100, 100, 100, 100, 100, 100, 200,             100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,            100, 100, 100, 100, 100, 100, 100, 100, 100, 200,      100, 100, 100, 100, 100, 100, 100, 100, 100, 200,             100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,      100, 100, 100, 100, 100, 100, 100, 100, 100, 200,      100, 100, 100, 100, 100, 100, 100, 100, 100, 200,             100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,              100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,             100, 100, 100, 100, 100, 100, 100, 100, 100, 200};
		short MegHm49_R[] = {150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,         150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,        150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,  150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,         150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,  150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,  150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,         150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,          150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,         150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50};

		short MegHm63[]   = {D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2,	     D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2,         0, -1};
		short MegHm63_L[] = {100, 100, 100, 100, 100, 100, 100, 100, 100, 200,      100, 100, 100, 100, 100, 100, 100, 100, 100, 200,         0};
		short MegHm63_R[] = {150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,  150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,     4*500*6};
		#endif

		#if 1 //Megalovania Bass note arrays
		short MegBm1[]   = {0, A, -1};
		short MegBm1_L[] = {0, 0};
		short MegBm1_R[] = {4*500*4, 125};

		short MegBm5[]   = {D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2,        C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2,       B/4, B/4, B/4, B/4, B/4, B/4, B/4, B/4, B/4, B/4,        Bb/4, Bb/4, Bb/4, Bb/4, C/2, C/2, C/2, C/2, C/2, C/2, -1};
		short MegBm5_L[] = {100, 100, 100, 100, 100, 100, 100, 100, 100, 200,        100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,        100, 100, 100, 100, 100, 100, 100, 100, 100, 200};
		short MegBm5_R[] = {150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,    150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,    150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50};

		short MegBm9[]   = {D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4,        C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4,       B/8, B/8, B/8, B/8, B/8, B/8, B/8, B/8, B/8, B/8,        Bb/8, Bb/8, Bb/8, Bb/8, C/4, C/4, C/4, C/4, C/4, C/4, -1};
		short MegBm9_L[] = {100, 100, 100, 100, 100, 100, 100, 100, 100, 200,        100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,        100, 100, 100, 100, 100, 100, 100, 100, 100, 200};
		short MegBm9_R[] = {150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,    150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,    150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50};

		short MegBm13[]   = {D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4,        C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4,       B/8, B/8, B/8, B/8, B/8, B/8, B/8, B/8, B/8, B/8,        Bb/8, Bb/8, Bb/8, Bb/8, C/4, C/4, C/4, C/4, C/4, C/4, -1};
		short MegBm13_L[] = {100, 100, 100, 100, 100, 100, 100, 100, 100, 200,        100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,        100, 100, 100, 100, 100, 100, 100, 100, 100, 200};
		short MegBm13_R[] = {150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,    150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,    150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50};

		short MegBm17[]   = {D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2, D/2,        C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, C/2, C, C/2,       B/4, B/4, B/4, B/4, B/4, B/4, B/4, B/4, B/4, B/4,        Bb/4, Bb/4, Bb/4, Bb/4, C/2, C/2, C/2, C/2, C/2, C, C/2, -1};
		short MegBm17_L[] = {100, 100, 100, 100, 100, 100, 100, 100, 100, 200,        100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100,     100, 100, 100, 100, 100, 100, 100, 100, 100, 200,        100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100};
		short MegBm17_R[] = {150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,    150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 25, 25,  150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,    150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 25, 25};

		short MegBm21[]   = {D/2, D/2, D, A/2, Ab/2, G/2, F/2, D/2, F/2, G/2,        C/2, C/2, D, A/2, Ab/2, G/2, F/2, D/2, F/2, G/2,             B/4, B/4, D, A/2, Ab/2, G/2, F/2, D/2, F/2, G/2,          Bb/4, Bb/4, D, A/2, G/2, F/2, D/2, F/2, G/2, -1};
		short MegBm21_L[] = {100, 100, 100, 100, 100, 100, 200, 100, 100, 100,       100, 100, 100, 100, 100, 100, 200, 100, 100, 100,            100, 100, 100, 100, 100, 100, 200, 100, 100, 100,         100, 100, 100, 100, 100, 200, 100, 100, 100};
		short MegBm21_R[] = {25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,   25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,        25, 25, 150, 150+125, 25+125, 25+125, 50, 25, 25, 25,     25, 25, 150, 150+250+125, 25+125, 50, 25, 25, 25};

		short MegBm25[]   = {Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/4,   C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/2,       D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/2,	     Cs/4, Cs/4, Cs/4, Cs/4, Cs/4, Cs/4, Cs/4, Cs/4, Cs/4, Cs/2,       Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/4,   C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/2,       D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/2,	      Cs/4, Cs/4, Cs/4, Cs/4, Cs/4, Cs/4, Cs/4, Cs/4, Cs/4, Cs/2, -1};
		short MegBm25_L[] = {100, 100, 100, 100, 100, 100, 100, 100, 100, 200,             100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,        100, 100, 100, 100, 100, 100, 100, 100, 100, 200,                 100, 100, 100, 100, 100, 100, 100, 100, 100, 200,             100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,        100, 100, 100, 100, 100, 100, 100, 100, 100, 200};
		short MegBm25_R[] = {150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,         150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,    150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,             150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,         150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,    150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50};

		short MegBm33[]   = {Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8,   C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4,       B/8, B/8, B/8, B/8, B/8, B/8, B/8, B/8, B/8, B/8,	     B/8, B/8, B/8, B/8, B/8, B/8, B/8, B/8, B/8, B/8,                 Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8,   C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4,       D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4,	      D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, -1};
		short MegBm33_L[] = {100, 100, 100, 100, 100, 100, 100, 100, 100, 200,             100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,        100, 100, 100, 100, 100, 100, 100, 100, 100, 200,                 100, 100, 100, 100, 100, 100, 100, 100, 100, 200,             100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,        100, 100, 100, 100, 100, 100, 100, 100, 100, 200};
		short MegBm33_R[] = {150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,         150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,    150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,             150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,         150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,    150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50};

		short MegBm41[]   = {Bb/8,     C/4,       B/8,         B/8,       Bb/8,        C/4,       B/8,        B/8, -1};
		short MegBm41_L[] = {4*500,    4*500,     4*500,       4*500,     4*500,       4*500,     4*500,      4*500-50};
		short MegBm41_R[] = {0,        0,         0,           0,         0,           0,         0,          50+50};

		short MegBm49[]   = {Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8,   C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4,       D/4, D/4, D/4, D/4, Cs/4, Cs/4, Cs/4, Cs/4, Cs/4, Cs/4,	     C/4, C/4, C/4, C/4, B/8, B/8, B/8, B/8, B/8, B/8,      Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8,   C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4,       D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4,	     D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4,      Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8,   C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4,       D/4, D/4, D/4, D/4, Cs/4, Cs/4, Cs/4, Cs/4, Cs/4, Cs/4,	     C/4, C/4, C/4, C/4, B/8, B/8, B/8, B/8, B/8, B/8,       Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8, Bb/8,   C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, C/4, -1};
		short MegBm49_L[] = {100, 100, 100, 100, 100, 100, 100, 100, 100, 200,             100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,            100, 100, 100, 100, 100, 100, 100, 100, 100, 200,      100, 100, 100, 100, 100, 100, 100, 100, 100, 200,             100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,      100, 100, 100, 100, 100, 100, 100, 100, 100, 200,      100, 100, 100, 100, 100, 100, 100, 100, 100, 200,             100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,              100, 100, 100, 100, 100, 100, 100, 100, 100, 200,       100, 100, 100, 100, 100, 100, 100, 100, 100, 200,             100, 100, 100, 100, 100, 100, 100, 100, 100, 200};
		short MegBm49_R[] = {150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,         150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,        150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,  150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,         150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,  150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,  150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,         150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,          150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,   150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,         150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50};

		short MegBm63[]   = {D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4,	     D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4, D/4,      0, -1};
		short MegBm63_L[] = {100, 100, 100, 100, 100, 100, 100, 100, 100, 200,      100, 100, 100, 100, 100, 100, 100, 100, 100, 200,      0};
		short MegBm63_R[] = {150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,  150, 150, 25, 25+125, 25+125, 25+125, 25, 25, 25, 50,  4*500*6};
		#endif

		short* MegMelody[]   = {MegMm1, MegMm5, MegMm9, MegMm13, MegMm17, MegMm21, MegMm25, MegMm25, MegMm33, MegMm41, MegMm49, MegMm63};
		short* MegMelody_L[] = {MegMm1_L, MegMm5_L, MegMm9_L, MegMm13_L, MegMm17_L, MegMm21_L, MegMm25_L, MegMm25_L, MegMm33_L, MegMm41_L, MegMm49_L, MegMm63_L};
		short* MegMelody_R[] = {MegMm1_R, MegMm5_R, MegMm9_R, MegMm13_R, MegMm17_R, MegMm21_R, MegMm25_R, MegMm25_R, MegMm33_R, MegMm41_R, MegMm49_R, MegMm63_R};

		short* MegHarmony[]   = {MegHm1, MegHm5, MegHm9, MegHm13, MegHm17, MegHm21, MegHm25, MegHm25, MegHm33, MegHm41, MegHm49, MegHm63};
		short* MegHarmony_L[] = {MegHm1_L, MegHm5_L, MegHm9_L, MegHm13_L, MegHm17_L, MegHm21_L, MegHm25_L, MegHm25_L, MegHm33_L, MegHm41_L, MegHm49_L, MegHm63_L};
		short* MegHarmony_R[] = {MegHm1_R, MegHm5_R, MegHm9_R, MegHm13_R, MegHm17_R, MegHm21_R, MegHm25_R, MegHm25_R, MegHm33_R, MegHm41_R, MegHm49_R, MegHm63_R};

		short* MegBass[]   = {MegBm1, MegBm5, MegBm9, MegBm13, MegBm17, MegBm21, MegBm25, MegBm25, MegBm33, MegBm41, MegBm49, MegBm63};
		short* MegBass_L[] = {MegBm1_L, MegBm5_L, MegBm9_L, MegBm13_L, MegBm17_L, MegBm21_L, MegBm25_L, MegBm25_L, MegBm33_L, MegBm41_L, MegBm49_L, MegBm63_L};
		short* MegBass_R[] = {MegBm1_R, MegBm5_R, MegBm9_R, MegBm13_R, MegBm17_R, MegBm21_R, MegBm25_R, MegBm25_R, MegBm33_R, MegBm41_R, MegBm49_R, MegBm63_R};

	#endif

	#if 1 //Hollow Knight
		
		#if 1 //Hollow Knight Melody note arrays
		short HKMm1[]   = {C*4, C*4, D*4, Eb*4,     D*4,         C*4, G*2, Ab*2, G*2, F*2,    G*2,         C*4, C*4, D*4, Eb*4,     F*4,          G*4, Eb*4, D*4, C*4, Bb*2,     C*4,          F, -1};
		short HKMm1_L[] = {1040, 1040, 500, 500,    1090*3-50,   500, 500, 1040, 500, 500,    1090*3-50,   1040, 1040, 500, 500,    1090*3-50,    500, 500, 500, 500, 1040,      1090*3-50,    1090*2-50-200};
		short HKMm1_R[] = {50, 50, 45, 45,          50,          45, 45, 50, 45, 45,          50,          50, 50, 45, 45,          50,           45, 45, 45, 45, 50,            50+200,       50+1090};

		short HKMm10[]   = {C*2, C*2, D*2, Eb*2,     D*2,          C*2, G, Ab, G, F,           G,            C*2, C*2, D*2, Eb*2,      F*2, G*2, Ab*2,            G*2, Eb*2, Bb,             C*2, Bb, F, -1};
		short HKMm10_L[] = {1040, 1040, 500, 500,    3*1090-50,    500, 500, 1040, 500, 500,   3*1090-50,    1040, 1040, 500, 500,     2*1090+545-50, 222, 222,   1040, 1090+545-50, 500,    1040, 1090+545-50, 500};
		short HKMm10_R[] = {50, 50, 45, 45,          50,           45, 45, 50, 45, 45,         50,           50, 50, 45, 45,           50, 50, 51,                50, 50, 45,                50, 50, 45};

		short HKMm18[]   = {G,           G,                    B,        B, C*2,              C*2, D*2, Eb*2,             F*2, G*2,           G*2, Bb*2,                 C*4, -1};
		short HKMm18_L[] = {3*1090-50,   3*1090*2-545-50,      500,      1040, 2*1090-50,     2*1090+363-50, 313, 314,    1040, 2*1090-50,    2*1090-50, 1090+545-50,    4*1090-50};
		short HKMm18_R[] = {50+3*1090,   50,                   45,       50, 50,              50, 50, 50,                 50, 50,             50, 50,                    50+1000};
		#endif

		#if 1 //Hollow Knight Harmony note arrays
		short HKHm1[]   = {C, G, Ab,              C, F, G,                C, Eb, F,                C, D, Eb, D, Bb/2,           C, G, Ab,                 Bb/2, G, F,             Ab/2, Eb, F,            F/2, Bb/2, C, F, C, Bb/2,       C, -1};
		short HKHm1_L[] = {500, 500, 1090*2-50,   500, 500, 1090*2-50,    500, 500, 1090*2-50,     500, 500, 500, 500, 1040,    500, 500, 1090*2-50,      500, 500, 1090*2-50,    500, 500, 1090*2-50,    500, 500, 500, 500, 500, 500,   1090*2-50-50};
		short HKHm1_R[] = {45, 45, 50,            45, 45, 50,             45, 45, 50,              45, 45, 45, 45, 50,          45, 45, 50,               45, 45, 50,             45, 45, 50,             45, 45, 45, 45, 45, 45+50,      50+1090};
		
		short HKHm10[]   = {C, C, D, Eb,             D,            C, G/2, Ab/2, G/2, F/2,     G/2,          C, C, D, Eb,              F, G, Ab,                  G, Eb, Bb,                 C, Bb/2, F, -1};
		short HKHm10_L[] = {1040, 1040, 500, 500,    3*1090-50,    500, 500, 1040, 500, 500,   3*1090-50,    1040, 1040, 500, 500,     2*1090+545-50, 222, 222,   1040, 1090+545-50, 500,    1040, 1090+545-50, 500};
		short HKHm10_R[] = {50, 50, 45, 45,          50,           45, 45, 50, 45, 45,         50,           50, 50, 45, 45,           50, 50, 51,                50, 50, 45,                50, 50, 45};

		short HKHm18[]   = {C,              D/2, Bb/4, D/2, -1};
		short HKHm18_L[] = {3*1090*2-50,    1040, 1040, 1040};
		short HKHm18_R[] = {50+3*1090,      50, 50, 50+3*1090*5};

		#endif

		#if 1 //Hollow Knight Bass note arrays
		short HKBm1[]   = {A,            A/2, Eb/2, -1};
		short HKBm1_L[] = {0,           2*1090-50, 1040};
		short HKBm1_R[] = {3*1090*8,    50, 50};

		short HKBm10[]   = {C/2, G/2, Ab/2,          C/2, F/2, G/2,          C/2, Eb/2, F/2,          Bb/4, Eb/2, D/2, Bb/4,     Ab/4, Eb/2, F/2,          F/4, C/2, F/2, G/2, Ab/2, C,     Eb/4, C/2, Eb/2, G/2, C, Eb,      Ab/4, Eb/2, Bb/4, F/2, D/2, -1};
		short HKBm10_L[] = {500, 500, 2*1090-50,     500, 500, 2*1090-50,    500, 500, 2*1090-50,     500, 500, 1040, 1040,      500, 500, 2*1090-50,      500, 500, 500, 500, 500, 500,    500, 500, 500, 500, 500, 500,     500, 500, 500, 500, 1040};
		short HKBm10_R[] = {45, 45, 50,              45, 45, 50,             45, 45, 50,              45, 45, 50, 50,            45, 45, 50,               45, 45, 45, 45, 45, 45,          45, 45, 45, 45, 45, 45,           45, 45, 45, 45, 50};
		
		short HKBm18[]   = {C/2, G/2, Ab/2, G/2, Ab/2, G/2,      C/2, F/2, G/2, F/2, G/2, F/2,       C/2, Eb/2, F/2, Eb/2, F/2, Eb/2,     Bb/4, F/4, Bb/4,      C/2, G/2, Ab/2, G/2, Ab/2, G/2,      C/2, F/2, G/2, F/2, G/2, F/2,       C/2, Eb/2, F/2, Eb/2, F/2, Eb/2,     Bb/4, D/2, F/2, Bb/2, D,             C, -1};
		short HKBm18_L[] = {500, 500, 500, 500, 500, 500,        500, 500, 500, 500, 500, 500,       500, 500, 500, 500, 500, 500,        1040, 1040, 1040,     500, 500, 500, 500, 500, 500,        500, 500, 500, 500, 500, 500,       500, 500, 500, 500, 500, 500,        500, 500, 500, 500, 1090+545-50,     4*1090-50};
		short HKBm18_R[] = {45, 45, 45, 45, 45, 45,              45, 45, 45, 45, 45, 45,             45, 45, 45, 45, 45, 45,              50, 50, 50,           45, 45, 45, 45, 45, 45,              45, 45, 45, 45, 45, 45,             45, 45, 45, 45, 45, 45,              45, 45, 45, 45, 50,                  50};
		
		#endif

		short* HKMelody[]   = {HKMm1, HKMm10, HKMm18};
		short* HKMelody_L[] = {HKMm1_L, HKMm10_L, HKMm18_L};
		short* HKMelody_R[] = {HKMm1_R, HKMm10_R, HKMm18_R};

		short* HKHarmony[]   = {HKHm1, HKHm10, HKHm18};
		short* HKHarmony_L[] = {HKHm1_L, HKHm10_L, HKHm18_L};
		short* HKHarmony_R[] = {HKHm1_R, HKHm10_R, HKHm18_R};

		short* HKBass[]   = {HKBm1, HKBm10, HKBm18};
		short* HKBass_L[] = {HKBm1_L, HKBm10_L, HKBm18_L};
		short* HKBass_R[] = {HKBm1_R, HKBm10_R, HKBm18_R};

	#endif

	#if 1 //Korok Forest (Day)
		
		#if 1 //Melody note arrays
		short KFMm1[]   = {A,        G*2, D*4,              C*4, G*2,              A*2, D*2,              F*2, C*2,           D*2, G*2, D*4,                     C*4, G*2,              A*2, D*2,             F*2, C*2, -1};
		short KFMm1_L[] = {0,        100, 309+2*618-50,     100, 309+2*618-50,     100, 309+2*618-50,     100, 200,           309+618-50, 100, 309+2*618-50,     100, 309+2*618-50,     100, 309+2*618-50,    100, 200};
		short KFMm1_R[] = {3*618,    209, 50+618,           209, 50+618,           209, 50+618,           209, 109+309,       50+618, 209, 50+618,               209, 50+618,           209, 50+618,          209, 109+618+309};

		short KFMm9[]   = {D*2, G, D*2,                C*2, Bb, A, F, G, D*2, D*2,               F*2, C*2, D*2, G, D*2,                 C*2, Bb, A, G, A, D, G, -1};
		short KFMm9_L[] = {309+618-50, 100, 618-50,    100, 100, 259, 259, 259, 100, 618-50,     259, 100, 309+618-50, 100, 618-50,     100, 100, 259, 259, 618-50, 100, 100};
		short KFMm9_R[] = {50, 209, 50,                54, 55, 50, 50, 50, 209, 50+309,          50, 209, 50, 209, 50,                  54, 55, 50, 50, 50, 209-50, 209+309};

		short KFMm13[]   = {D*2, G*2, D*4,              C*4, G*2,              A*2, D*2,              F*2, C*2,           D*2, G*2, D*4,                     C*4, G*2,              A*2, D*2,             F*2, C*2, -1};
		short KFMm13_L[] = {100, 100, 309+2*618-50,     100, 309+2*618-50,     100, 309+2*618-50,     100, 200,           309+618-50, 100, 309+2*618-50,     100, 309+2*618-50,     100, 309+2*618-50,    100, 200};
		short KFMm13_R[] = {209+2*618, 209, 50+618,     209, 50+618,           209, 50+618,           209, 109+309,       50+618+50, 209, 50+618,            209, 50+618,           209, 50+618,          209, 109+309};

		short KFMm21[]   = {D*2, G, D, G, D*2,               D*2, C*2, Bb,          C*2, F, Eb, D,                 Eb, Bb, A, G,                 A, D, G, D*2,                            G*2, F*2, -1};
		short KFMm21_L[] = {100, 2*618-50, 259, 259, 259,    2*618-50, 259, 259,    100, 309+618-50, 259, 259,     100, 309+618-50, 259, 259,    100, 309+618-50, 100, 309+2*618-50,      100, 309+618-50};
		short KFMm21_R[] = {209+309, 50, 50, 50, 50,         50+618, 50, 50,        209, 50+618, 50, 50,           209, 50+618, 50, 50,          209, 50+618, 209, 50+618,                209, 50+309};

		short KFMm28[]   = {C*2, F, Bb, C*2, Db*2, Eb*2,          F*2, Eb*2, Db*2, C*2, Bb, Ab, Bb, G, Eb,        F, F*2, D*2, G*2,                      D, Eb, D, Eb, F, G, F, G, A*2, D*2,                      F, G, A, Bb, C, -1};
		short KFMm28_L[] = {618-50, 100, 100, 100, 100, 100,      259, 100, 100, 100, 100, 259, 100, 100, 100,    618-50, 618-50, 618-50, 309+618-50,    100, 100, 100, 100, 100, 100, 100, 100, 100, 618-50,     100, 100, 100, 100, 309+2*618};
		short KFMm28_R[] = {50, 209, 54, 55, 54, 55,              50, 54, 55, 209, 209, 50, 209, 209, 209,        50, 50, 50+309, 50,                    54, 55, 54, 55, 54, 55, 54, 55, 209, 50,                 54, 55, 54, 55, 50+1000};
		#endif

		#if 1 //Harmony note arrays
		short KFHm1[]   = {A, F, E,                F, E,              F, E,               F, E,              F, E,               F, E,             F, E,             F, E, -1};
		short KFHm1_L[] = {0, 100, 2*618-50,       100, 2*618-50,     100, 2*618-50,      100, 2*618-50,     100, 2*618-50,      100, 2*618-50,    100, 2*618-50,    100, 2*618-50};
		short KFHm1_R[] = {309, 209+618, 50+309,   209+618, 50+309,   209+618, 50+309,    209+618, 50+309,   209+618, 50+309,    209+618, 50+309,  209+618, 50+309,  209+618, 50+309};

		short KFHm9[]   = {G, Ab/2,              D,            C, D,                  D, D, D,                  D, D, -1};
		short KFHm9_L[] = {100, 309+618-50,      4*618-50,     618-50, 309+618-50,    2*618-50, 618-50, 100,    100, 309+618-50};
		short KFHm9_R[] = {209+309, 50+618,      50,           50+309, 50+618,        50, 50+309, 209+309,      209+309, 50+618+359};

		short KFHm14[]   = {F, E,              F, E,               F, E,              F, E,               F, E,             F, E,            Eb, D, D, -1};
		short KFHm14_L[] = {100, 2*618-50,     100, 2*618-50,      100, 2*618-50,     100, 2*618-50,      100, 2*618-50,    100, 2*618-50,   100, 309+618-50, 100};
		short KFHm14_R[] = {209+618, 50+309,   209+618, 50+309,    209+618, 50+309,   209+618, 50+329,    209+618, 50+309,  209+618, 50+309, 209+618, 50, 209+309};
		
		short KFHm21[]   = {C, D,                        D, D,                       C, C,                      D, D,                      A/2, A/2,             D, D,                      C, Cb, -1};
		short KFHm21_L[] = {100, 2*618-50,               259, 259,                   259, 259,                  259, 259,                  259, 618-50,          259, 259,                  259, 309+618-50};
		short KFHm21_R[] = {209+309, 50+309+618+309,     50+618, 50+309+618+309,     50+618, 50+309+618+309,    50+618, 50+309+618+309,    50+618, 50+618+309,   50+618, 50+309+618+309,    50+309, 50+618};

		short KFHm28[]   = {F, Eb, Bb/2, A/2,            D, C,                    Bb/2, C, Bb/2, C, D, Eb, D, Eb, A, D,                  D, Eb, F, G, E, -1};
		short KFHm28_L[] = {618-50, 100, 618-50, 100,    2*618-50, 2*618-50,      100, 100, 100, 100, 100, 100, 100, 100, 100, 618-50,   100, 100, 100, 100, 309+2*618-50};
		short KFHm28_R[] = {50, 209+309, 50, 209+309,    50, 50+618,              54, 55, 54, 55, 54, 55, 54, 55, 209, 50,               54, 55, 54, 55, 50};
		#endif

		#if 1 //Bass note arrays
		short KFBm1[]   = {A, G/4, Bb/2, G/4, A/2,        G/4, Bb/2, G/4, A/2,         G/4, Bb/2, G/4, A/2,        G/4, Bb/2, G/4, A/2,       G/4, Bb/2, G/4, A/2,         G/4, Bb/2, G/4, A/2,        G/4, Bb/2, G/4, A/2,       G/4, Bb/2, G/4, A/2, -1};
		short KFBm1_L[] = {0, 100, 100, 100, 2*618-50,    100, 100, 100, 2*618-50,     100, 100, 100, 2*618-50,    100, 100, 100, 2*618-50,   100, 100, 100, 2*618-50,     100, 100, 100, 2*618-50,    100, 100, 100, 2*618-50,   100, 100, 100, 2*618-50};
		short KFBm1_R[] = {0, 209, 209+309, 209, 50,      209, 209+309, 209, 50,       209, 209+309, 209, 50,      209, 209+309, 209, 40,     209, 209+309, 209, 50,       209, 209+309, 209, 50,      209, 209+309, 209, 50,     209, 209+309, 209, 40};

		short KFBm9[]   = {F/4, Ab, Bb/4,            Eb/2,          D/2, G/2,              C/2, D/2, Eb/2,            F/2, G/2, -1};
		short KFBm9_L[] = {100, 100, 309+618-50,     4*618-50,      618-50, 309+618-50,    2*618-50, 618-50, 100,     100, 309+618-50};
		short KFBm9_R[] = {209, 209+309, 50+618,     50,            50+309, 50+618,        50, 50+309, 209+309,       209+309, 50+618};
		
		short KFBm14[]   = {G/4, Bb/2, G/4, A/2,        G/4, Bb/2, G/4, A/2,         G/4, Bb/2, G/4, A/2,        G/4, Bb/2, G/4, A/2,       G/4, Bb/2, G/4, A/2,         G/4, Bb/2, G/4, A/2,             F/4, Ab/2, Bb/4, Ab/2, Eb/2, -1};
		short KFBm14_L[] = {100, 100, 100, 2*618-50,    100, 100, 100, 2*618-50,     100, 100, 100, 2*618-50,    100, 100, 100, 2*618-50,   100, 100, 100, 2*618-50,     100, 100, 100, 2*618-50,         100, 100, 100, 309+618-50, 100};
		short KFBm14_R[] = {209, 209+309, 209, 50,      209, 209+309, 209, 50,       209, 209+309, 209, 50,      209, 209+309, 209, 50,     209, 209+309, 209, 50,       209, 209+309, 209, 50,           209, 209+309, 209, 50, 209+309};
		
		short KFBm21[]   = {D/2, G/2,              Eb/2, G/2, Eb/2, G/2,           D/2, F/2, D/2, F/2,              C/2, Eb/2, C/2, Eb/2,           Bb/4, D/2, Bb/4, D/2,       Eb/2, G/2, Eb/2, G/2,          D/2, F/2, Db/2, -1};
		short KFBm21_L[] = {100, 2*618-50,         259, 259, 259, 259,             259, 259, 259, 259,              259, 259, 259, 259,             259, 259, 259, 618-50,      259, 259, 259, 259,            259, 259, 309+618-50};
		short KFBm21_R[] = {209+309, 50+309+618,   50, 50+309, 50, 50+309+618,     50, 50+309, 50, 50+309+618,      50, 50+309, 50, 50+309+618,     50, 50+309, 50, 50+618,     50, 50+309, 50, 50+309+618,    50, 50+309, 50+618};

		short KFBm28[]   = {Gb/2, Ab/2, Cb/2, Db/2,       Eb/2, D/2,             G/4, Bb/2, G/4, A/2,        G/4, Bb/2, D/2, -1};
		short KFBm28_L[] = {618-50, 100, 618-50, 100,     2*618-50, 2*618-50,    259, 259, 259, 2*618-50,    259, 259, 309+2*618-50};
		short KFBm28_R[] = {50, 209+309, 50, 209+309,     50, 50,                50, 50+309, 50, 50,         50, 50+309, 50};
		#endif


		short* KFMelody[]   = {KFMm1, KFMm9, KFMm13, KFMm21, KFMm28};
		short* KFMelody_L[] = {KFMm1_L, KFMm9_L, KFMm13_L, KFMm21_L, KFMm28_L};
		short* KFMelody_R[] = {KFMm1_R, KFMm9_R, KFMm13_R, KFMm21_R, KFMm28_R};

		short* KFHarmony[]   = {KFHm1, KFHm9, KFHm14, KFHm21, KFHm28};
		short* KFHarmony_L[] = {KFHm1_L, KFHm9_L, KFHm14_L, KFHm21_L, KFHm28_L};
		short* KFHarmony_R[] = {KFHm1_R, KFHm9_R, KFHm14_R, KFHm21_R, KFHm28_R};

		short* KFBass[]   = {KFBm1, KFBm9, KFBm14, KFBm21, KFBm28};
		short* KFBass_L[] = {KFBm1_L, KFBm9_L, KFBm14_L, KFBm21_L, KFBm28_L};
		short* KFBass_R[] = {KFBm1_R, KFBm9_R, KFBm14_R, KFBm21_R, KFBm28_R};

	#endif

	short** Melody[]   = {MegMelody, HKMelody, KFMelody};
	short** Melody_L[] = {MegMelody_L, HKMelody_L, KFMelody_L};
	short** Melody_R[] = {MegMelody_R, HKMelody_R, KFMelody_R};

	short** Harmony[]   = {MegHarmony, HKHarmony, KFHarmony};
	short** Harmony_L[] = {MegHarmony_L, HKHarmony_L, KFHarmony_L};
	short** Harmony_R[] = {MegHarmony_R, HKHarmony_R, KFHarmony_R};

	short** Bass[]   = {MegBass, HKBass, KFBass};
	short** Bass_L[] = {MegBass_L, HKBass_L, KFBass_L};
	short** Bass_R[] = {MegBass_R, HKBass_R, KFBass_R};

	char rows[] = {12, 3, 5};
#endif

#if 1 //global variables
	unsigned char prev, next;
	unsigned char pause = 1;
	unsigned char Reset = 0;
	unsigned char remote;
	unsigned char melodyDone = 0;
	unsigned long songs = sizeof(Melody) / sizeof(Melody[0]);
	unsigned char globalL;
	char* songNames[] = {"Megalovania", "Hollow Knight", "Korok Forest"};
	
	unsigned int  state1_i EEMEM = 0;
	unsigned int  state1_j EEMEM = 0;
	unsigned int  state1_k EEMEM = 0;
	unsigned char state1_l EEMEM = 0;
	
	unsigned int  state2_i EEMEM = 0;
	unsigned int  state2_j EEMEM = 0;
	unsigned int  state2_k EEMEM = 0;
	
	unsigned int  state3_i EEMEM = 0;
	unsigned int  state3_j EEMEM = 0;
	unsigned int  state3_k EEMEM = 0;
	
	unsigned char state1_save EEMEM = 1;
	unsigned char state2_save EEMEM = 1;
	unsigned char state3_save EEMEM = 1;
#endif

typedef struct _task {
	signed char state;
	unsigned long int period;
	unsigned long int elapsedTime;
	int (*TickFct) (int);
} task;
#if 1 //function definitions
volatile unsigned char TimerFlag = 0;
unsigned long _avr_timer_M = 1;
unsigned long _avr_timer_cntcurr = 0;

void TimerOn() {
	TCCR2B = 0x0B;
	OCR2A = 125;
	TIMSK2 = 0x02;
	TCNT2 = 0;
	_avr_timer_cntcurr = _avr_timer_M;
	SREG |= 0x80;
}
void TimerOff() {
	TCCR2B = 0x00;
}
void TimerISR() {
	TimerFlag = 1;
}
ISR(TIMER2_COMPA_vect) {
	_avr_timer_cntcurr--;
	if (_avr_timer_cntcurr == 0) {
		TimerISR();
		_avr_timer_cntcurr = _avr_timer_M;
	}
}
void TimerSet(unsigned long M) {
	_avr_timer_M = M;
	_avr_timer_cntcurr = _avr_timer_M;
}

void set_PWM1(double frequency) {
	static double current_frequency;
	if (frequency != current_frequency) {
		if (!frequency) { TCCR1B &= 0x08; }
		else { TCCR1B |= 0x03; }
		
		if (frequency < 0.954) { OCR1A = 0xFFFF; }
		else if (frequency > 31250) {OCR1A = 0x0000; }
		else {OCR1A = (short)(8000000 / (128 * frequency)) + 0; }
		
		TCNT1 = 0;
		current_frequency = frequency;
	}
}
void PWM1_on() {
	TCCR1A = (1 << COM1A0);
	TCCR1B = (1 << WGM12) | (1 << CS11) | (1 << CS10);
	set_PWM1(0);
}
void PWM1_off() {
	TCCR1A = 0x00;
	TCCR1B = 0x00;
}
void tone1(double frq) {
	set_PWM1(frq);
}
void noTone1() {
	set_PWM1(0);
}

void set_PWM3(double frequency) {
	static double current_frequency;
	if (frequency != current_frequency) {
		if (!frequency) { TCCR3B &= 0x08; }
		else { TCCR3B |= 0x03; }
		
		if (frequency < 0.954) { OCR3A = 0xFFFF; }
		else if (frequency > 31250) {OCR3A = 0x0000; }
		else {OCR3A = (short)(8000000 / (128 * frequency)) + 0; }
		
		TCNT3 = 0;
		current_frequency = frequency;
	}
}
void PWM3_on() {
	TCCR3A = (1 << COM3A0);
	TCCR3B = (1 << WGM32) | (1 << CS31) | (1 << CS30);
	set_PWM1(0);
}
void PWM3_off() {
	TCCR3A = 0x00;
	TCCR3B = 0x00;
}
void tone3(double frq) {
	set_PWM3(frq);
}
void noTone3() {
	set_PWM3(0);
}

void set_PWM0(double frequency) {
	static double current_frequency;
	if (frequency != current_frequency) {
		if (!frequency) { TCCR0B &= 0x08; TCCR0A |= 0x03;}
		else { TCCR0B |= 0x05; }
		
		if (frequency < 31) { OCR0A = 0xFF; }
		else if (frequency > 3906) {OCR0A = 0x00; }
		else {OCR0A = (char)(8000000 / (2 * 1024 * frequency)) + 0.5; }
		
		TCNT0 = 0;
		current_frequency = frequency;
	}
}
void PWM0_on() {
	TCCR0A = (1 << COM0A0);
	TCCR0B = (1 << WGM02) | (1 << WGM01) | (1 << WGM00) | (1 << CS02) | (1 << CS00);
	set_PWM0(0);
}
void PWM0_off() {
	TCCR0A = 0x00;
	TCCR0B = 0x00;
}
void tone0(double frq) {
	set_PWM0(frq);
}
void noTone0() {
	set_PWM0(0);
}

unsigned char GetBit(unsigned char port, unsigned char number) {
	return (port & (0x01 << number));
}

void USART_Init( unsigned int ubrr)
{
	/*Set baud rate */
	UBRR0H = (unsigned char)(ubrr>>8);
	UBRR0L = (unsigned char)ubrr;
	/* Enable receiver and transmitter */
	UCSR0B = (1<<RXEN0)|(1<<TXEN0);
	/* Set frame format: 8data, 2stop bit */
	UCSR0C = (1<<USBS0)|(3<<UCSZ00);
	}
unsigned char USART_Receive( void )
{
	/* Wait for data to be received */
	while ( !(UCSR0A & (1<<RXC0)) )
	;
	/* Get and return received data from buffer */
	return UDR0;
}
#endif

#if 1 //tick function definitions
enum States1 {init1, wait1, play1, length1, rest1, pause1};
int tickSM_play1(int state) {
	static unsigned int i, j, k;
	static unsigned char l;
	switch(state) {
		case init1:
		state = pause1;
		i = eeprom_read_word(&state1_i);
		j = eeprom_read_word(&state1_j);
		k = eeprom_read_word(&state1_k);
		l = eeprom_read_byte(&state1_l);
		globalL = l;
		prev = 0;
		next = 0;
		pause = 1;
		Reset = 0;
		noTone3();
		break;

		case wait1:
		if (Reset) {
			state = 0;
			break;
		}
		if (!pause) {
			state= play1;
		} else {
			state= wait1;
		}
		break;

		case play1:
		globalL = l;
		if (Reset) {
			state = 0;
			break;
		}
			melodyDone = 0;
		if (pause) {
			noTone3();
			eeprom_update_word(&state1_i, i);
			eeprom_update_word(&state1_j, j);
			eeprom_update_word(&state1_k, k);
			eeprom_update_byte(&state1_l, l);
			eeprom_update_byte(&state1_save, state);
			state = pause1;
			break;
		}
		if (prev && (i == 0)) {
			i = 0; j = 0; k = 0;
			if (l == 0) {
				l = songs - 1;
			} else {
				l--;
			}
			globalL = l;
			state = play1;
			break;
		} else if (prev){
			i = 0; j = 0; k = 0;
			state = play1;
			break;
		}
		if (next) {
			i = 0; j = 0; k = 0;
			l++;
			if (l == songs) {
				l = 0;
			}
			globalL = l;
			state = play1;
			break;
		}
		if (Melody[l][i][j] == -1) {
			i++;
			j = 0;
		}
		if (i == rows[l]) {
			melodyDone = 1;
			state = wait1;
			i = 0; j = 0; k = 0;
			l++;
			if (l == songs) {
				l = 0;
			}
			globalL = l;
			break;
		}
		tone3(Melody[l][i][j]);
		state = length1;
		break;

		case length1:
		if (Reset) {
			state = 0;
			break;
		}
		if (pause) {
			noTone3();
			eeprom_update_word(&state1_i, i);
			eeprom_update_word(&state1_j, j);
			eeprom_update_word(&state1_k, k);
			eeprom_update_byte(&state1_l, l);
			eeprom_update_byte(&state1_save, state);
			state = pause1;
			break;
		}
		if (prev && (i == 0)) {
			i = 0; j = 0; k = 0;
			if (l == 0) {
				l = songs - 1;
			} else {
				l--;
			}
			globalL = l;
			state = play1;
			break;
		} else if (prev){
			i = 0; j = 0; k = 0;
			state = play1;
			break;
		}
		if (next) {
			i = 0; j = 0; k = 0;
			l++;
			if (l == songs) {
				l = 0;
			}
			globalL = l;
			state = play1;
			break;
		}
		if (k < Melody_L[l][i][j]) {
			k++;
			state = length1;
			} else {
			k = 0;
			noTone3();
			state = rest1;
		}
		break;

		case rest1:
		if (Reset) {
			state = 0;
			break;
		}
		if (pause) {
			noTone3();
			eeprom_update_word(&state1_i, i);
			eeprom_update_word(&state1_j, j);
			eeprom_update_word(&state1_k, k);
			eeprom_update_byte(&state1_l, l);
			eeprom_update_byte(&state1_save, state);
			state = pause1;
			break;
		}
		if (prev && (i == 0)) {
			i = 0; j = 0; k = 0;
			if (l == 0) {
				l = songs - 1;
			} else {
				l--;
			}
			globalL = l;
			state = play1;
			break;
		} else if (prev){
			i = 0; j = 0; k = 0;
			state = play1;
			break;
		}
		if (next) {
			i = 0; j = 0; k = 0;
			l++;
			if (l == songs) {
				l = 0;
			}
			globalL = l;
			state = play1;
			break;
		}
		if (k < Melody_R[l][i][j]) {
			k++;
			state = rest1;
			} else {
			k = 0;
			j++;
			state = play1;
		}
		break;

		case pause1:
		if (Reset) {
			state = 0;
			break;
		}
		if (prev && (i == 0)) {
			i = 0; j = 0; k = 0;
			if (l == 0) {
				l = songs - 1;
			} else {
				l--;
			}
			globalL = l;
			pause = 0;
			state = play1;
			break;
		} else if (prev){
			i = 0; j = 0; k = 0;
			pause = 0;
			state = play1;
			break;
		}
		if (next) {
			i = 0; j = 0; k = 0;
			l++;
			if (l == songs) {
				l = 0;
			}
			globalL = l;
			pause = 0;
			state = play1;
			break;
		}
		if (pause) {
			state = pause1;
			} else {
			if (eeprom_read_byte(&state1_save) == length1) {
				tone3(Melody[l][i][j]);
			}
			state = eeprom_read_byte(&state1_save);
		}
		break;
			
	}
	return state;
}

enum States2 {init2, wait2, play2, length2, rest2, pause2};
int tickSM_play2(int state) {
	static unsigned int i, j, k;
	static unsigned char l;
	switch(state) {
		case init2:
		state = pause2;
		i = eeprom_read_word(&state2_i);
		j = eeprom_read_word(&state2_j);
		k = eeprom_read_word(&state2_k);
		l = globalL;
		noTone1();
		break;

		case wait2:
			l = globalL;
		if (Reset) {
			state = 0;
			break;
		}
		if (melodyDone && !pause) {
			state= play2;
			} else {
			state= wait2;
		}
		break;

		case play2:
		if (Reset) {
			state = 0;
			break;
		}
		if (pause) {
			noTone1();
			eeprom_update_word(&state2_i, i);
			eeprom_update_word(&state2_j, j);
			eeprom_update_word(&state2_k, k);
			eeprom_update_byte(&state2_save, state);
			state = pause2;
			break;
		}
		if (prev && (i == 0)) {
			i = 0; j = 0; k = 0;
			l = globalL;
			state = play2;
			break;
		} else if (prev){
			i = 0; j = 0; k = 0;
			state = play2;
			break;
		}
		if (next) {
			i = 0; j = 0; k = 0;
			l = globalL;
			state = play2;
			break;
		}
		if (Harmony[l][i][j] == -1) {
			i++;
			j = 0;
		}
		if (i == rows[l]) {
			state = wait2;
			i = 0; j = 0; k = 0;
			l = globalL;
			break;
		}
		tone1(Harmony[l][i][j]);
		state = length2;
		break;

		case length2:
		if (Reset) {
			state = 0;
			break;
		}
		if (pause) {
			noTone1();
			eeprom_update_word(&state2_i, i);
			eeprom_update_word(&state2_j, j);
			eeprom_update_word(&state2_k, k);
			eeprom_update_byte(&state2_save, state);
			state = pause2;
			break;
		}
		if (prev && (i == 0)) {
			i = 0; j = 0; k = 0;
			l = globalL;
			state = play2;
			break;
		} else if (prev){
			i = 0; j = 0; k = 0;
			state = play2;
			break;
		}
		if (next) {
			i = 0; j = 0; k = 0;
			l = globalL;
			state = play2;
			break;
		}
		if (k < Harmony_L[l][i][j]) {
			k++;
			state = length2;
			} else {
			k = 0;
			noTone1();
			state = rest2;
		}
		break;

		case rest2:
		if (Reset) {
			state = 0;
			break;
		}
		if (pause) {
			noTone1();
			eeprom_update_word(&state2_i, i);
			eeprom_update_word(&state2_j, j);
			eeprom_update_word(&state2_k, k);
			eeprom_update_byte(&state2_save, state);
			state = pause2;
			break;
		}
		if (prev && (i == 0)) {
			i = 0; j = 0; k = 0;
			l = globalL;
			state = play2;
			break;
		} else if (prev){
			i = 0; j = 0; k = 0;
			state = play2;
			break;
		}
		if (next) {
			i = 0; j = 0; k = 0;
			l = globalL;
			state = play2;
			break;
		}
		if (k < Harmony_R[l][i][j]) {
			k++;
			state = rest2;
			} else {
			k = 0;
			j++;
			state = play2;
		}
		break;

		case pause2:
		if (Reset) {
			state = 0;
			break;
		}
		if (melodyDone) {
			state = wait2;
			i = 0; j = 0; k = 0;
			l = globalL;
			break;
		}
		if (prev && (i == 0)) {
			i = 0; j = 0; k = 0;
			l = globalL;
			pause = 0;
			state = play2;
			break;
		} else if (prev){
			i = 0; j = 0; k = 0;
			pause = 0;
			state = play2;
			break;
		}
		if (next) {
			i = 0; j = 0; k = 0;
			l = globalL;
			pause = 0;
			state = play2;
			break;
		}
		if (pause) {
			state = pause2;
			} else {
			if (eeprom_read_byte(&state2_save) == length2) {
				tone1(Harmony[l][i][j]);
			}
			state = eeprom_read_byte(&state2_save);
		}
		break;
	}
	return state;
}

enum States3 {init3, wait3, play3, length3, rest3, pause3};
int tickSM_play3(int state) {
	static unsigned int i, j, k;
	static unsigned char l;
	switch(state) {
		case init3:
		state = pause3;
		i = eeprom_read_word(&state3_i);
		j = eeprom_read_word(&state3_j);
		k = eeprom_read_word(&state3_k);
		l = globalL;
		noTone0();
		break;

		case wait3:
		l = globalL;
		if (Reset) {
			state = 0;
			break;
		}
		if (melodyDone && !pause) {
			state= play3;
			} else {
			state= wait3;
		}
		break;

		case play3:
		if (Reset) {
			state = 0;
			break;
		}
		if (pause) {
			noTone0();
			eeprom_update_word(&state3_i, i);
			eeprom_update_word(&state3_j, j);
			eeprom_update_word(&state3_k, k);
			eeprom_update_byte(&state3_save, state);
			state = pause3;
			break;
		}
		if (prev && (i == 0)) {
			i = 0; j = 0; k = 0;
			l = globalL;
			prev = 0;
			state = play3;
			break;
		} else if (prev){
			i = 0; j = 0; k = 0;
			prev = 0;
			state = play3;
			break;
		}
		if (next) {
			i = 0; j = 0; k = 0;
			l = globalL;
			next = 0;
			state = play3;
			break;
		}
		if (Bass[l][i][j] == -1) {
			i++;
			j = 0;
		}
		if (i == rows[l]) {
			state = wait3;
			i = 0; j = 0; k = 0;
			l = globalL;
			break;
		}
		tone0(Bass[l][i][j]);
		state = length3;
		break;

		case length3:
		if (Reset) {
			state = 0;
			break;
		}
		if (pause) {
			noTone0();
			eeprom_update_word(&state3_i, i);
			eeprom_update_word(&state3_j, j);
			eeprom_update_word(&state3_k, k);
			eeprom_update_byte(&state3_save, state);
			state = pause3;
			break;
		}
		if (prev && (i == 0)) {
			i = 0; j = 0; k = 0;
			l = globalL;
			prev = 0;
			state = play3;
			break;
		} else if (prev){
			i = 0; j = 0; k = 0;
			prev = 0;
			state = play3;
			break;
		}
		if (next) {
			i = 0; j = 0; k = 0;
			l = globalL;
			next = 0;
			state = play3;
			break;
		}
		if (k < Bass_L[l][i][j]) {
			k++;
			state = length3;
			} else {
			k = 0;
			noTone0();
			state = rest3;
		}
		break;

		case rest3:
		if (Reset) {
			state = 0;
			break;
		}
		if (pause) {
			noTone0();
			eeprom_update_word(&state3_i, i);
			eeprom_update_word(&state3_j, j);
			eeprom_update_word(&state3_k, k);
			eeprom_update_byte(&state3_save, state);
			state = pause3;
			break;
		}
		if (prev && (i == 0)) {
			i = 0; j = 0; k = 0;
			l = globalL;
			prev = 0;
			state = play3;
			break;
		} else if (prev){
			i = 0; j = 0; k = 0;
			prev = 0;
			state = play3;
			break;
		}
		if (next) {
			i = 0; j = 0; k = 0;
			l = globalL;
			next = 0;
			state = play3;
			break;
		}
		if (k < Bass_R[l][i][j]) {
			k++;
			state = rest3;
			} else {
			k = 0;
			j++;
			state = play3;
		}
		break;

		case pause3:
		if (Reset) {
			state = 0;
			break;
		}
		if (melodyDone) {
			state = wait3;
			i = 0; j = 0; k = 0;
			l = globalL;
			break;
		}
		if (prev && (i == 0)) {
			i = 0; j = 0; k = 0;
			l = globalL;
			prev = 0;
			pause = 0;
			state = play3;
			break;
		} else if (prev){
			i = 0; j = 0; k = 0;
			prev = 0;
			pause = 0;
			state = play3;
			break;
		}
		if (next) {
			i = 0; j = 0; k = 0;
			l = globalL;
			next = 0;
			pause = 0;
			state = play3;
			break;
		}
		if (pause) {
			state = pause3;
			} else {
			if (eeprom_read_byte(&state3_save) == length3) {
				tone0(Bass[l][i][j]);
			}
			state = eeprom_read_byte(&state3_save);
		}
		break;
	}
	return state;
}

enum pause_states {pause_init, toggle_press, toggle_rel};
int pause_tick(int state) {
	unsigned char button = PINA & 0x01;
	switch (state) {
		case pause_init:
			pause = 1;
			state = toggle_press;
		break;

		case toggle_press:
			if (remote == PlayPause || button) {
				state = toggle_rel;
				pause = !pause;
			} else {
				state = toggle_press;
			}
		break;
		
		case toggle_rel:
			if (remote == PlayPause || button) {
				state = toggle_rel;
			} else {
				state = toggle_press;
			}
		break;

		default: state = pause_init; break;
	}
	return state;
};

enum remote_states {receive};
int remote_tick(int state) {
	switch (state) {
		case receive:
			remote = USART_Receive();
			if (remote == Power) {
				pause = 1;
			}
			state = receive;
		break;
	}
	return state;
};

enum change_states {waitChange, previous, nextSong};
int change_tick(int state) {
	switch (state) {
		case waitChange:
			if (remote == Previous) {
				prev = 1;
				state = previous;
			} else if (remote == Next) {
				next = 1;
				state = nextSong;
			} else {
				prev = 0; next = 0;
				state = waitChange;
			}
		break;

		case previous:
			if (remote == Previous) {
				state = previous;
			} else {
				state = waitChange;
			}
		break;

		case nextSong:
			if (remote == Next) {
				state = nextSong;
			} else {
				state = waitChange;
			}
		break;

		default:
			state = waitChange;
		break;
	}
	return state;
};

enum reset_states {reset};
int reset_tick(int state) {
	switch (state) {
		case reset:
			if (remote == Eq) {
				LCD_ClearScreen();

				eeprom_write_word(&state1_i, 0);
				eeprom_write_word(&state1_j, 0);
				eeprom_write_word(&state1_k, 0);
				eeprom_write_byte(&state1_l, 0);

				LCD_DisplayString(3, "Resetting...");
				
				eeprom_write_word(&state2_i, 0);
				eeprom_write_word(&state2_j, 0);
				eeprom_write_word(&state2_k, 0);
				
				eeprom_write_word(&state3_i, 0);
				eeprom_write_word(&state3_j, 0);
				eeprom_write_word(&state3_k, 0);
				
				eeprom_write_byte(&state1_save, 2);
				eeprom_write_byte(&state2_save, 2);
				eeprom_write_byte(&state3_save, 2);

				pause = 1;
				Reset = 1;

				LCD_ClearScreen();
			}
			state = reset;
		break;
	}
	return state;
};

enum lcd_states {init, pauseClear, paused, playClear, play};
int lcd_tick(int state) {
	static unsigned char prevL = 0;
	switch (state) {
		case init:
			LCD_ClearScreen();
			state = pauseClear;
		break;

		case pauseClear:
			LCD_DisplayString(5, "Paused");
			state = paused;
		break;
			

		case paused:
			if (pause) {
				state = paused;
			} else {
				LCD_ClearScreen();
				state = playClear;
			}
		break;

		case playClear:
			LCD_DisplayString(2, "Now Playing...");
			LCD_DisplayString(17+8-ceil((strlen(songNames[globalL]))/2.0), songNames[globalL] );
			state = play;
		break;

		case play:
			if (pause) {
				LCD_ClearScreen();
				state = pauseClear;
			} else {
				if (globalL != prevL) {
					LCD_ClearScreen();
					prevL = globalL;
					state = playClear;
					break;
				}
				state = play;
			}
		break;
	}
	return state;
};

#endif

int main(void) {
    /* Insert DDR and PORT initializations */
	DDRA = 0x00; PORTA = 0x00;
	DDRB = 0xFF; PORTB = 0x00;
	DDRC = 0xFF; PORTC = 0x00;
	DDRD = 0xF0; PORTD = 0x00;

	unsigned char timerPeriod = 1;

	#if 1 //task assignment
	static task task1, task2, task3, task4, task5, task6, task7, task8;
	task *tasks[] = { &task1, &task2, &task3, &task4, &task5, &task6, &task7, &task8};
	const unsigned short numTasks = sizeof(tasks) / sizeof(*tasks);
	
	task1.state = 0;
	task1.period = 50;
	task1.elapsedTime = task1.period;
	task1.TickFct = &remote_tick;
	
	task2.state = 0;
	task2.period = 1;
	task2.elapsedTime = task2.period;
	task2.TickFct = &pause_tick;
	
	task3.state = 0;
	task3.period = 1;
	task3.elapsedTime = task3.period;
	task3.TickFct = &change_tick;
	
	task4.state = 0;
	task4.period = 1;
	task4.elapsedTime = task4.period;
	task4.TickFct = &reset_tick;
	
	task5.state = 0;
	task5.period = 1;
	task5.elapsedTime = task5.period;
	task5.TickFct = &tickSM_play1;
	
	task6.state = 0;
	task6.period = 1;
	task6.elapsedTime = task6.period;
	task6.TickFct = &tickSM_play2;
	
	task7.state = 0;
	task7.period = 1;
	task7.elapsedTime = task7.period;
	task7.TickFct = &tickSM_play3;

	task8.state = 0;
	task8.period = 50;
	task8.elapsedTime = task8.period;
	task8.TickFct = &lcd_tick;

	#endif

	TimerSet(timerPeriod);
	TimerOn();
	PWM3_on(); PWM1_on(); PWM0_on();
	USART_Init(MYUBRR);
	LCD_init();

	while(1) {
	#if 1 //task execution
		for (unsigned char i = 0; i < numTasks; i++) {
			if ( tasks[i]->elapsedTime == tasks[i]->period) {
				tasks[i]->state = tasks[i]->TickFct(tasks[i]->state);
				tasks[i]->elapsedTime = 0;
			}
			tasks[i]->elapsedTime += timerPeriod;
	#endif
	}

		while(!TimerFlag){};
		TimerFlag = 0;
	}
	

    return 1;
}
